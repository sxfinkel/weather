<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Local Weather</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Quicksand|Sacramento' rel='stylesheet' type='text/css'>
  </head>

  <style>
    .data {
      font-family: Quicksand;
      font-size: 22px;
    }

    .data h1 {
      font-family: Sacramento;
      font-size: 42px;
    }

    .center-block {
      margin-top: 60px;
      float: none !important;
    }
  </style>
  <body>
    <div class="background container-fluid">
      <div class="row">
        <div class="col-sm-6 center-block text-center">
          <div class="data">
            <div id="waiting">
              <h1>Retrieving your weather info...</h1>
              <i class="fa fa-3x fa-spinner fa-spin fa-pulse"></i>
            </div>
            <div id="weather-data">
              <h1 id="summary"></h1>
              <p>Current temperature: <span id="currentTemp"></span> °<span class="units">F</span></p>
              <p>Feels like: <span id="feelsTemp"></span> °<span class="units">F</span></p>
            </div>
          </div>
        </div>
        <div class="col-sm-6 center-block text-center">
          <button class="btn btn-large btn-info convertUnits">°C</button>

          <!-- <button class="btn btn-large btn-info toFahrenheit">°F</button>
          <button class="btn btn-large btn-info toCelsius">°C</button> -->
          </div>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script>
      $(document).ready(function() {
        $("#weather-data").hide(0);
        $(".convertUnits").hide(0);

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(success, error);

          function success(position) {
            var key = "6d0af58f1221cec34ad4126a975288ab";
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;
            var data;

            $.getJSON( "https://api.forecast.io/forecast/" + key + "/" + lat + "," + lon + "?units=us" + "&callback=?", function(data) {
              $("#waiting").hide(0);
              $("#weather-data").show(0);

              var convertToCelsius = function (temp) {
                return (temp - 32) * (5/9)
              }

              var summary = data.currently.summary;
              var currentFahrenheitTemp = Math.round(data.currently.temperature);
              var feelsFahrenheitTemp = Math.round(data.currently.apparentTemperature);

              var currentCelsiusTemp = Math.round(convertToCelsius(currentFahrenheitTemp));
              var feelsCelsiusTemp = Math.round(convertToCelsius(feelsFahrenheitTemp));

              $("#summary").html(summary);
              $("#currentTemp").html(currentFahrenheitTemp);
              $("#feelsTemp").html(feelsFahrenheitTemp);
              $(".convertUnits").show(0);

              $("button").click(function() {
                if ($(".units").html() === "C") {
                  $("#currentTemp").html(currentFahrenheitTemp);
                  $("#feelsTemp").html(feelsFahrenheitTemp);
                  $(".units").html("F");
                  $(".convertUnits").html("°C");
                } else if ($(".units").html() === "F") {
                  $("#currentTemp").html(currentCelsiusTemp);
                  $("#feelsTemp").html(feelsCelsiusTemp);
                  $(".units").html("C");
                  $(".convertUnits").html("°F");
                }
              });
            });
          };

          function error() {
            $("#data").html("Sorry, unable to retrieve your location.");
          };

        } else {
          $("#data").html("Sorry, geolocation is not supported by your browser.");
        }
      })
    </script>
  </body>
</html>
